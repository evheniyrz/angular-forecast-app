import{a as U,b as m,f as B,h as w,l as K}from"./chunk-2OFM3SAW.js";import{$ as h,A as S,J as g,N as G,P as q,X as P,_ as z,a as p,aa as v,b as l,ca as L,f as W,fa as u,h as x,ia as _,k as H,ka as a,m as j,mc as N,n as C,p as O,r as A,s as R,sc as M,t as E,v as y,w as k,x as $,z as b}from"./chunk-IHJBBD4Q.js";function ee(){return o=>new x(r=>{let e,t,i=new W;return i.add(o.subscribe({complete:()=>{e&&r.next(t),r.complete()},error:n=>{r.error(n)},next:n=>{t=n,e||(e=C.schedule(()=>{r.next(t),e=void 0}),i.add(e))}})),i})}function J(o){return typeof o.ngrxOnStoreInit=="function"}function Y(o){return typeof o.ngrxOnStateInit=="function"}var te=new _("@ngrx/component-store Initial State"),X=(()=>{class o{constructor(e){this.destroySubject$=new j(1),this.destroy$=this.destroySubject$.asObservable(),this.stateSubject$=new j(1),this.isInitialized=!1,this.state$=this.select(t=>t),this.state=B(this.stateSubject$.pipe(h(this.destroy$)),{requireSync:!1,manualCleanup:!0}),this.\u0275hasProvider=!1,e&&this.initState(e),this.checkProviderForHooks()}ngOnDestroy(){this.stateSubject$.complete(),this.destroySubject$.next()}updater(e){return t=>{let i=!0,n,s=($(t)?t:y(t)).pipe(R(O),v(()=>this.assertStateIsInitialized()),L(this.stateSubject$),b(([d,F])=>e(F,d)),v(d=>this.stateSubject$.next(d)),g(d=>i?(n=d,A):k(d)),h(this.destroy$)).subscribe();if(n)throw n;return i=!1,s}}initState(e){E([e],O).subscribe(t=>{this.isInitialized=!0,this.stateSubject$.next(t)})}setState(e){typeof e!="function"?this.initState(e):this.updater(e)()}patchState(e){let t=typeof e=="function"?e(this.get()):e;this.updater((i,n)=>p(p({},i),n))(t)}get(e){this.assertStateIsInitialized();let t;return this.stateSubject$.pipe(G(1)).subscribe(i=>{t=e?e(i):i}),t}select(...e){let{observablesOrSelectorsObject:t,projector:i,config:n}=re(e);return(ie(t,i)?this.stateSubject$:S(t)).pipe(n.debounce?ee():Q(),i?b(s=>t.length>0&&Array.isArray(s)?i(...s):i(s)):Q(),q(n.equal),P({refCount:!0,bufferSize:1}),h(this.destroy$))}selectSignal(...e){let t=[...e],i=typeof t[e.length-1]=="object"?t.pop():{},n=t.pop(),c=t,s=c.length===0?()=>n(this.state()):()=>{let d=c.map(F=>F());return n(...d)};return M(s,i)}effect(e){let t=new H;return e(t).pipe(h(this.destroy$)).subscribe(),i=>($(i)?i:y(i)).pipe(h(this.destroy$)).subscribe(c=>{t.next(c)})}checkProviderForHooks(){C.schedule(()=>{if(N()&&(J(this)||Y(this))&&!this.\u0275hasProvider){let e=[J(this)?"OnStoreInit":"",Y(this)?"OnStateInit":""].filter(t=>t);console.warn(`@ngrx/component-store: ${this.constructor.name} has the ${e.join(" and ")} lifecycle hook(s) implemented without being provided using the provideComponentStore(${this.constructor.name}) function. To resolve this, provide the component store via provideComponentStore(${this.constructor.name})`)}})}assertStateIsInitialized(){if(!this.isInitialized)throw new Error(`${this.constructor.name} has not been initialized yet. Please make sure it is initialized before updating/getting.`)}static{this.\u0275fac=function(t){return new(t||o)(a(te,8))}}static{this.\u0275prov=u({token:o,factory:o.\u0275fac})}}return o})();function re(o){let r=Array.from(o),t={debounce:!1,equal:(c,s)=>c===s};if(oe(r[r.length-1])&&(t=p(p({},t),r.pop())),r.length===1&&typeof r[0]!="function")return{observablesOrSelectorsObject:r[0],projector:void 0,config:t};let i=r.pop();return{observablesOrSelectorsObject:r,projector:i,config:t}}function oe(o){let r=o;return typeof r.debounce<"u"||typeof r.equal<"u"}function ie(o,r){return Array.isArray(o)&&o.length===0&&r}function Q(){return o=>o}var f=class o extends K{constructor(r,e,t){super(r,e,t)}weatherGet(r="Mykolayiv",e="ua"){let t=this.generateGetRequestParams({q:`${r},${e}`,units:"metric"}),i=new U("GET","",{params:t,withCredentials:!0,responseType:"json",observe:"body",reportProgress:!1});return this.apiRequest(i).pipe(b(n=>n.body),g(n=>y({code:n??["cod"],message:n.message})))}static \u0275fac=function(e){return new(e||o)(a(String),a(String),a(m))};static \u0275prov=u({token:o,factory:o.\u0275fac})};var D=class o extends f{constructor(r,e){super(r,"/weather",e)}getCurrentForecast(r){return this.weatherGet(r.city,r.country_code)}generateTemplateData(r){return{todayOverviewDTO:{weather:{description:r.weather[0].description,main:r.weather[0].main,icon:this.generateLargeIconUrl(r.weather[0].icon)},temp_min:r.main.temp_min,sys:{name:r.name,country:r.sys.country}},nowForecastDTO:{wind:{speed:r.wind.speed,deg:r.wind.deg,gust:r.wind.gust},date:r.dt*1e3,main:{temp:r.main.temp}}}}generateLargeIconUrl(r){return`https://rodrigokamada.github.io/openweathermap/images/${r}_t@4x.png`}static \u0275fac=function(e){return new(e||o)(a(w),a(m))};static \u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})};var T=class o extends f{constructor(r,e){super(r,"/forecast",e)}fifeDaysForecastData(r){return this.weatherGet(r.city,r.country_code)}static \u0275fac=function(e){return new(e||o)(a(w),a(m))};static \u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})};var ne={geo:{},weatherList:[],todayForecast:{},dailyForecast:{nowForecast:{},fiveDaysForecast:[]},statisticsState:[],initialized:!1},V=class o extends X{constructor(e,t){super(ne);this.weatherService=e;this.currentDayForecast=t}setAppWeatherState=this.effect(e=>e.pipe(z(t=>S([this.weatherService.fifeDaysForecastData(t),this.currentDayForecast.getCurrentForecast(t)]).pipe(v({next:([i,n])=>{Number(i.cod)<400&&this.appStateInitializer([t,i,n])}})))));appStateInitializer=this.updater((e,t)=>l(p({},e),{geo:t[0],weatherList:t[1].list,todayForecast:this.todayForecastData(t[2]),dailyForecast:{nowForecast:this.nowForecastTemplateData(t[2]),fiveDaysForecast:this.selectRepresentative(this.groupByDate(t[1]))},statisticsState:t[1].list.slice(0,12),initialized:!0}));updateWeatherState=this.updater((e,t)=>l(p({},e),{weatherList:t}));updateGeoState=this.updater((e,t)=>l(p({},e),{geo:t}));updateTodayWeatherState=this.updater((e,t)=>l(p({},e),{todayForecast:this.todayForecastData(t)}));updateForecastStatisticsState=this.updater((e,t)=>l(p({},e),{statisticsState:t}));sliceJSWeatherState(e,t){return this.select(i=>i.weatherList?.slice(e,t))}todayForecastData(e){return{weather:{description:e.weather[0].description,main:e.weather[0].main,icon:this.generateLargeIconUrl(e.weather[0].icon),weather_id:e.weather[0].id},temp_min:e.main.temp_min,sys:{name:e.name,country:e.sys.country}}}nowForecastTemplateData(e){return{wind:{speed:e.wind.speed,deg:e.wind.deg,gust:e.wind.gust},date:e.dt*1e3,main:{temp:e.main.temp}}}groupByDate(e){return e.list.reduce((t,i)=>{let n=i.dt_txt.split(" ")[0];return t[n]||(t[n]=[]),t[n].push(i),t},{})}selectRepresentative(e){return Object.entries(e).map(([t,i])=>{let n=i.reduce((c,s)=>{let d=parseInt(s.dt_txt.split(" ")[1].split(":")[0]);return Math.abs(d-12)<Math.abs(parseInt(c.dt_txt.split(" ")[1].split(":")[0])-12)?s:c});return{icon:this.generateLargeIconUrl(n.weather[0].icon),date:n.dt*1e3,weatherState:n.weather[0].description,temp:n.main.temp}})}generateLargeIconUrl(e){return`https://rodrigokamada.github.io/openweathermap/images/${e}_t@4x.png`}static \u0275fac=function(t){return new(t||o)(a(T),a(D))};static \u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})};export{D as a,T as b,V as c};
